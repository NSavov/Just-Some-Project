@model IEnumerable<StudentRanking.DataAccess.FacultyRankList>
@{
    ViewBag.Title = "FacultyRankList";
    var res = ViewData["result"] as List<StudentRanking.DataAccess.FacultyRankList>;
    bool isMainAdmin = (bool)ViewData["mainAdmin"];
    bool isRankListPublished = (bool)ViewData["isRankListPublished"];
    bool isRankingDate = (bool)ViewData["isRankingDate"];
    
}

<style>
    table, th, td {
        border: 0px solid black;
        border-collapse: collapse;
    }

    th, td {
        padding: 15px;
    }
</style>

@section Scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#programmeName").prop("disabled", true);
            $("#faculty").change(function () {
                if ($("#faculty").val() != "Please select") {
                    var options = {};
                    options.url = "/ProgrammeRankList/getprogrammes";
                    options.type = "POST";
                    options.data = JSON.stringify({ faculty: $("#faculty").val() });
                    options.dataType = "json";
                    //<a href="~/Views/ProgrammeRules/Index.cshtml">~/Views/ProgrammeRules/Index.cshtml</a>
                    options.contentType = "application/json";
                    options.success = function (states) {
                        $("#programmeName").empty();
                        for (var i = 0; i < states.length; i++) {
                            $("#programmeName").append("<option>" + states[i] + "</option>");
                        }
                        $("#programmeName").prop("disabled", false);
                    };
                    options.error = function () { alert("Error retrieving states!"); };
                    $.ajax(options);
                }
                else {
                    $("#programmeName").empty();
                    $("#programmeName").prop("disabled", true);
                }
            });
        });

        function SubmitClick() {
            $.ajax({
                type: 'POST',
                url: "/ProgrammeRankList/index",
                data: {
                    faculty: $("#faculty option:selected").text(),
                    programmeName: $("#programmeName option:selected").text()
                },
                success: function (data) {
                    $('#resultTable').html(data);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }

            });
        };

        function Publish() {
            $.ajax({

                type: 'post',
                url: "/ProgrammeRankList/algoStart",
                success: function (result) {
                    window.location.href = result.Url;
                }

            });
        };
    </script>
}

@if (isRankingDate)
{
    if (isMainAdmin && !isRankListPublished)
    {
        <label>Натиснете бутона, за да публикувате класирането.</label>
        <input type="submit" value="Публикувайте" onclick="javascript: Publish()" />
    }
    else
    {
        if (!isMainAdmin && !isRankListPublished)
        {
            <label>Класирането не е публикувано. Само главният администратор може да публикува класирането.</label>
        }
        else
        {
            if (isRankListPublished)
            {
                <h2>Класиране по специалност</h2>
                <br>
                <div><h4>Изберете факултет:</h4></div>
                @Html.DropDownList("faculty", ViewData["faculties"] as SelectList, new { @id = "faculty" })
                <select id="programmeName"></select>
                <input type="submit" value="Потвърдете" onclick="javascript:SubmitClick()" />

                <div id="resultTable">
                    @Html.Partial("_ProgrammeRankListTable", Model)
                </div>
            }
        }

    }


}
else
{
    <label>Не е настъпила датата за публикуване на класирането.</label>
}


